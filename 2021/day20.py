#!/usr/local/bin/python3
input_alg="#.#.#.....###.###..##...##.#.###..##..#.#..#.#..###.#.####.######......#.#..###.#....#.#...########....#.#..#.##.##.#.######..#..#..#.##.##.##..###..##.####.##.##.#.##.##..#.#..#####..##..#.##.#.#......###.#.#..#.#..##.###..###.#####.#...##.##.#.##..####..#.....####..........#...#.#..#..#..##.##....##...#.#..#.....#.##..####.#.##.#.##.#.####.##.#.##..#..##.#.##.###.....##.#.####...#.#.##..#..##...####..#.#.#...###....#..#.#..#..###..#..#..#...#.#.##.##.#...######.##..##.###.#.###.###..#......#..#..#.#...#.."

input="""##..#.#...#...#.#..#..##.#.#.##.##.####.##.#.#.##..##..##..#...##..##.#....##.#.####.##...#..#....##
###..#..#..##..#####..##.#.##.##.##.#...##......#...#..#.#..#.....#####...#.######...#.....#...##.##
..##.#..#......#.....##......##.###.###..#####..###.####.#.#....#.#.##..##....####..#.....###..#.##.
#.##....#.....#.....#..####..##.####...#..#####.#.#.##.##.##.#..###...####..###.#...#.###..#..#..###
#.##..#....#.#..#.##....#..#...##.#..#..##.#.#####...#..###...##.#.#....#..#..#....##.#..##..##..#.#
...####.#.####..#.###.....##..#...##...#.######....####...#.#....##.#......#.#.##.##.###...#...#...#
##..##.#....#.....#.#.#####.#.####.#.#.#.#####.###..#.......###.#.###......###.##..##.#####.#.##.###
####.#..#####.##....###...##..###..#...###..###.####..#.##..##.#...####.....#..#.#..##...##.#.###...
.#..#...##...####.#.###......#..##...#.##.##.#.#.##.#..##.#.#.#.#..###...###..###..###...###....#...
#.#####..###....###..##....######.#.#..#...#.####.###.####..#.##..##..#.#.#.#..#####....##.##...##..
....#.#.......#.#...#.##...#.#.##.#.###.#.####..#.####...########...#.###.#.#.....#.####.#..#..#.###
.##.###.##..#....##..#.##..###......#.##.##.##...#.#...##.#######.#.#.#..###..##..####....##...#..##
#....#..##..#.######....##.#.#........#..#.#..#.....#.#..##.#.#.##.##.#####..##...#.##..#..#....####
#..##..#.#.....###.#.###.##.#.#.###...###...###..##..##.##.......##......##.#.##.#...#.##..#....#..#
#.#.#.#.#.###..###.##..#..#........###..###.##..##.####.##....#..#.......#...###..#..#..#...#.....#.
##...##.####..#####...#.#.##...##...####...##.##.##.#.#####..#..###.#.###.###.#.#.#..#...#.#.####..#
..#..##..#####.##..##...#....###..#.#.....##...######.#..##.#..#####..#.##.#.#.#..#..#.#######..###.
.....#.#..####..##.###..###.....#.##...#.#.#...#..#...####.#....#..#...#.##...#..##..#.##....##.###.
......#.#...####....##.#....##..####.#...##...##..#.#.#.###..#.#..##....##...##.#.#..##.##.....###.#
#.####..###..###.#...##..#.#.####..#...#.....###.##..###...#....#######.####.#...#.#.###..####...#.#
###...#.#...#..####.##..###...........#..#....#..#.####.#.......##.##.###.#.#....#.#.#.#...#.#..#...
.##.#.#.#.#...###...#...#..#.#.#...##..#..##....#...##..#.#..###.#....##.###....###...######.##.####
.....##....#....#.#######.#..##..#..#.....###..#....#.####.##.#..##.#...##..##.#.#.###....#..#...###
..##.#.###.#.####.#.#######.#...#.##.#..##.#####...#.###...###.##.#.###...#..#......########..##..#.
####...#..##......#.#.###.#####.#....#..#..##.....#....##.#.#...###......###.#...#.##.#.......#.....
#.##...#.##..###.#####..###..##.#..##..#..##.##..###...#.##.#..######.##.#...#.#.##....###.#..#.##.#
##.#...##.#.####.#.#.#...#..#.####.##.#..#.#.##...##.###..#..###..#.###....#.###.#.#.###.#...####.##
.##...#..#..##..#######...#..####...###..#..#.#..##.#.##.#..#..###.#.##..#.#...###...#######.####.##
##..#.##.#...###.........#.#..#..#.#..#.#..#...##.#.##......#.####.##..###..#.###.#.#####.###...#.#.
...#.###.#..#....####.###.##..####.#.###..##.#.####.##...#.##..#.##.###....#.#.#.##......#.####.....
.###.#######..#....####.#..#.#...####.#.....#.#.#.###.###.#.##.###.####..#####...#.....##...###....#
#..#..#.######.##.###.....###..##.#...###.#.#####...####..###..##.###...#..##....##...##.#.##.##..#.
..##...#...#.####..##...#....#..#.##..###.####.##..###.#..####..##.#.####..####..##.#####..###.###..
.#..#..#..#....##.#.#####.#.#......#.###.....#.####..#.#.#......#..#.#....#....####..###.#.....#..#.
##.#.##....#...#...#.##.#..........####.##...#..#..##.###...#.#..##########..###.##.#.###.#.#.#.##.#
..#.##.####....##.#..#.##...##.##..##.###.##.....##..##..#.#.#.#.....#...#...##.#..#.....#####.####.
#.#.#..####.####....###.##.##.....###..#####.#......#.#...#..###..##.###.#....#.#.#####.#..#.#######
##..###.#.##..####..#..#.#..##..#...###....#..##.####..##..##.##..###.###.####.#.##.###..##.####.#..
..#.##.#.#####.#....###.#.#..#.###.#.#...##.#.#....#.##...#..#####..###..#.#.####.#...#.####...##...
...###.#..##.#.#...#..#.#.##.#.##.##.#.#.#####..###...#...#...#.#.###......#.##.#.#..#.###.##.####.#
#....#.##......##...##.....####.#.##..##.#..##.###########..#..##.#...##.##......##....#......##.#..
##...#####.###.###..#.###....#.#.#..#..#.#####...###....#.##.#.####....#.#....######....#.#.##.####.
....##....#..##......##.....#.##..####.##.##.#.#.#....#...#...##.##..#....#..##...#.#....#.#..#.###.
...#.......#.#...#....#.#.#....#...#...##.##...###.####......#..###.##....######.##.####.##.....#...
####..###..##...#......##...##..#.#...###..####.###.#....##.###.#..##.#...##.##........####.#...###.
..##.##.#..####..###.#..####...#..#.#..#...#.##..#..##.#######....#...##..#..#.#......#.#.####.#.#..
####.#.#...##....###..#.#..#..#.#...####.###...#####..######.#.....#..###.##.##........###.##.##.###
.#.#..#....##.###..##.......###.#...#.######...#####.#..#######...##.##.#..#...#.....#...####.###..#
..#....##.....#....###..##.##..####.....###...#.#...####..###..##....#...###...####.##..########....
..........###...#.......##...####...#######....##..#.##.##.###..###...#######..#..####.##..#.##..##.
#######...###...##.##..#.#....#..#..#...###..#..#.#.#..#..###..#....#...##....#..#.#.......#########
.#..##........##.......#.###..#.#.#####.##.#.####..#.#.##...#..#...#.#.##..##.#..##.#####.##....##.#
....##....##.#..#.#...#.....###....##...#.#.#...#.###.....#.#.....#..#####.#..##..#.#####........#..
##.##.#....#..##..##.##.###..#.#.##..###.#..##...####.######.#.#.#...#..#.#.#...#.#..######.#....#..
##.###.#......###..#.#..#.#..#...######.##.##.#####.####......######...####.##.#####...#..#...#.###.
.#########....##..###..#.#....####.###.....#..#...##.###.##..####.#.##..#..#....##..###.##..##.#.##.
#.#.#.###...#####..###.####.#####.##.#.#...##..##.#.#...###..##....###.#...##.###.....###...########
###.#.###.....#.#.#..#.#...###.##........#.####..#...###.#.##.####..###.#..#...##.#..##.#.#...#.##.#
..##.#..#.#..##.##.##...####..####.#####.##..#...####...##...###...#####.#####.##...###..#...#.#.##.
##.#.#.#.####..#.##.#...#........##..#.###.###.#.....#..#..##.#####..##.#.####.#......###.#####..#.#
#.######.###...#.###..#..#.#.#.#.###.##..###.###..#.###..#####...##..####..##.######.#.##..#.#.##...
.##.#.#.####...###.......#.####...#..###.#.....#.#......##.#.##.###.#####....##.#.#.###......###.#..
###..#.##.####....##.##.#..#.###........###.####....#...#...##...#..###.##.###..####.#.#.#.##.#.....
###...#.###.....#...#.#.#..#.#....##.#.#.#.#.#..#..##.###.###...#....#####..####.##...##.#.###.#..##
..##......#..####...##.#..##.##.......##.####.#.#.###.###...##.#.###..###...########.##...#.##....##
.#...#.##..#..###.####.##.#.#.#..#..#.#....#..#..........#####.##.#.#.###.#.##....#...##.#.#.#..#...
..#...##..#.#.###.##..##..####.####..#.....####.##..#.#.#....#..##.##.#####...####.#..#.#...#....#.#
..##..#..#.#..........###.##..###..#...###.###...###..#.##.#####...####.##...####.##...#####.#.#....
..#..####.....###..#..##..##.#..#.####.##..##..#.#.##.##.##..#....#.####.#.#..##.#.####.#..#.##.#..#
.#.#.#############..###..##..######........##..###.#..###..##.....###.#.###.#.##.#.#.#.##.#..####..#
...#.###...#.#..#########.###.#..##..###.#.##......########.#....#######....#...#...###..#.#####..#.
..########.####..#..#.#..#..##.#.##...###.#..####..#.#####...##.###.###.##..##.#.#..##...##.##.#.#..
..##.##.#.......#.##..#.#.#####...#.#..#.#####...###.##....#....#..#..####...##....#......#....###..
...#...#..#.###..##...##.##..##.#.###...#...###..###.#..#######..#..##..####..##.#.#.#.#..#.##..#...
.#####...##.##.#.#.#.###.#.#..##.....#..###...#..#.##.#...#.....#.#...#..#.#...#..#######.#.#######.
#.##.#...###.#.##.#..#....##.##..#.##.##.#.##.##..#.#..##..#.#..#..#...##..####....#.##.#####....##.
#..#..###.###.##...#########.##.#.###....##.###.###.#.##.#.###....#.#..#.....######...#.#.#....#.#..
.....#.######.###.##.........##...#..#..#..##.##..#..###..##..#.#.##.#.#.###.......#.##.....####...#
.######.#.####...#.###......#..#.###.##.###.....##.#####..###...##.##.#...#.....#..#...##.#.#.#.####
.##..##.#.#..#..##..##.####.#...####......##...##.#####.###..#...#.##..#.#...#.#..#..#..#...#....###
...##.#..#.#..#.###.####.#.#.....#.#.#..##.##.#..#.###.#...##.####.#...#.##..#..####.#####..#.#.#..#
#.##.#..#..##.#..##...#.##.#.###...##.##..#.##.#.#..#..#..##..##.##.#.....#..##...#.#..#....#..####.
#.##..###...##..####.##.#.##..##........###.#..###.#.####..####.#.##.#....#######.#####..##.#..#####
..###.#.#...##....##...##..#..#.#.#.....#..#.#.#.####...#..#...#..#......###.##..#####.####..####..#
..#...#.##..###.#.##..#...###..##.#####.###.#.#.......#.#....###.####..#..#.#..#...###.#.#..###..##.
##.#.#.##.#..###.###......###..##..#..##.#..#.##.#..###..#.####...#..#####..#.####.##.#...#..#.##.#.
..#.##.#......#..............##.###..##.###.#.#.##...##.#.......#######.#...#..##.#..####..#.##.#.##
.##..........##...###......#.#.....#.##.##.##..####..##.#.##.#..###.#..####..##.#..#..#.###.##..#..#
##...##...###...#.##..##.####.....#.#.####.##..##.##.##........#.##...##...###########...#..#..#...#
.##.##.#..##.#.########...###...###.#...#.####...#.###.##.###...#...###...##...#........##.##.###.#.
##.#..###...######.#.#.#.#.#.#..........#..##...##..#....#..###..######.....#.#..##.#.#..##.##.##.#.
###.##..#.##..#...#.#...#.##...#.###.#..#..#..##.##.##..#..#..###.#.##...##...#.#.##.###.....#.###.#
.##..#.##....#.#......###.##.#.##......##..#.##..##..#..##..########..##.#..##...#..#...###.#...#.##
.###..#.#.......#....#...#.#....###.#.###.##.##..#.#.....#...#####.#..####.##.##.#.#.#.....#####.#..
##...##.#####.#....###.#.##.###.#.#.#..#..###..##..####..##..###.....##.#.########..#..##..#.#.#.###
..#.##.#.##..###..####.##..#..###....#..#....#.##..#.####.##.#...#.##.##..########.##.##.#.#.#...##.
.#..###.######.#.###.##.#.##......##.###.##.#....#......###....####.##.###.#..##.####.#..###.#......
#.....###....##.....###.#..#....#.#...#.#....#.##.######.####.###########...#..#..#..##.#.##.##....#
.##.#.#..#...#.#.##..#...####..#.#.#...##..#..#..##...####.#...######.....##...##.##.#..###.###..#..
..#.#..##....##...####.#...#...###..#......#.##....#.##...##......####.##.#.##.#.#.#..#...#..##..#.."""

test_alg="..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#"

test="""#..#.
#....
##..#
..#..
..###"""

import numpy as np
orig = np.matrix(input.replace(".", " 0 ").replace("#", " 1 ").replace("\n", ";"))
key = input_alg.replace(".", "0").replace("#", "1")

def enhance(mat, invert=False):
    r,c = mat.shape
    matrix = np.zeros((r+6,c+6))
    if invert:
        matrix = np.ones(matrix.shape)
    matrix[3:r+3,3:c+3] = mat

    enhanced = np.zeros(matrix.shape)
    for idx, _ in np.ndenumerate(matrix[1:r+5,1:c+5]):
        i = idx[0]+1
        j = idx[1]+1
        index = int("".join([str(int(x)) for x in matrix[i-1:i+2,j-1:j+2].flatten()]), 2)
        enhanced[i,j] = int(key[index])

    r,c = enhanced.shape
    return enhanced[1:r-1,1:c-1]

inverted = True
# for r in range(2): # original puzzle
for r in range(50): # second puzzle
    if inverted:
        inverted = False
    else:
        inverted = key[0] == "1"
    orig = enhance(orig, inverted)

print(int(np.sum(orig)))
